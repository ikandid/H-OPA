%AF_general
function [SLL_u, SLL_v]=SL_u_v(A,B,C,D,pos_final,lambda,w)

%paramaters
AF=0;

RES=1;
theta=linspace(-90,90,181*RES);
phi=linspace(-180,180,361*RES);
k=2*pi/lambda;%wavenumber

%u&v coordinates 
u=sind(theta).*cosd(transpose(phi));
v=sind(theta).*sind(transpose(phi));

%AF definition
AF=0;
%w = [0	0	0.140625000000000	0.0937500000000000	0.0156250000000000	0.562500000000000	0.109375000000000	0.257812500000000	0.242187500000000	0.843750000000000	0.0312500000000000	0.937500000000000	0.0781250000000000	0.171875000000000	0.890625000000000	0.148437500000000	0.476562500000000	0.320312500000000	0.351562500000000	0.132812500000000	0.429687500000000	0.476562500000000	0.421875000000000	0.117187500000000	0.210937500000000	0.804687500000000	0.781250000000000	0.312500000000000	0.421875000000000	0.164062500000000	0.343750000000000	0.0703125000000000	0.0468750000000000	0.593750000000000	0.859375000000000	0.281250000000000	0.500000000000000	0.0703125000000000	0.703125000000000	0.257812500000000	0.0546875000000000	0.601562500000000	0.460937500000000	0.406250000000000	0.984375000000000	0.0390625000000000	0.937500000000000	0.984375000000000	0.171875000000000	0.632812500000000	0.234375000000000	0.562500000000000	0.281250000000000	0.281250000000000	0.906250000000000	0.0781250000000000	0.523437500000000	0.320312500000000	0.367187500000000	0.250000000000000	0.375000000000000	0.109375000000000	0.265625000000000	0.0859375000000000	0.0546875000000000	0.914062500000000	0.945312500000000	0.445312500000000	0.578125000000000	0.984375000000000	0.617187500000000	0.0468750000000000	0.945312500000000	0.593750000000000	0.273437500000000	0.640625000000000	0.0312500000000000	0.164062500000000	0.351562500000000	0.00781250000000000	0.960937500000000	0.437500000000000	0.414062500000000	0.664062500000000	0.179687500000000	0.679687500000000	0.320312500000000	0.765625000000000	0.101562500000000	0.351562500000000	0.992187500000000	0.812500000000000	0.726562500000000	0.914062500000000	0.0937500000000000	0.156250000000000	0.976562500000000	0.203125000000000	0.757812500000000	0.875000000000000	0.140625000000000	0.226562500000000	0.234375000000000	0.203125000000000	0.437500000000000	0.921875000000000	0.539062500000000	0.523437500000000	0.492187500000000	0.195312500000000	0.101562500000000	0.117187500000000	0.148437500000000	0.742187500000000	0.773437500000000	0.171875000000000	0.945312500000000	0.679687500000000	0.304687500000000	0.710937500000000	0.453125000000000	0.500000000000000	0.0156250000000000	0.992187500000000	0.414062500000000	0.562500000000000	0.742187500000000	0.265625000000000	0.523437500000000	0.0156250000000000	0.765625000000000	0.703125000000000	0.976562500000000	0.546875000000000	0.593750000000000	0.0546875000000000	0.359375000000000	0.304687500000000	0.195312500000000	0.390625000000000	0.0156250000000000	0.625000000000000	0.289062500000000	0.382812500000000];
for n=1:A*B*C*D
    %w(end+1)=abs((2*n-1)/(A*B*C*D)-1);
    AF=AF+w(n)*exp(j*k*(pos_final(1,n)*u+pos_final(2,n)*v));
end

AF_mag=abs(AF);
AF_norm=AF_mag/max(max(AF_mag));

%Intensity & Normalized Intensity
Intensity=AF_mag.^2;
Intensity_norm=Intensity/max(max(Intensity));
Intensity_dB=10.*log10(Intensity_norm);

u_max = 91;
v_max = 181;
pat_uv_x=Intensity_norm(u_max,:);
pat_uv_y=Intensity_norm(v_max,:);

%pat_uv_el=Intensity_norm(:,v_max);

%convert to dB
pat_uv_x_dB=10.*log10(pat_uv_x);
pat_uv_y_dB=10.*log10(pat_uv_y);

% figure
% plot(theta,pat_uv_x_dB)
% 
% figure
% plot(theta,pat_uv_y_dB)

%Calculating SLL for u & v
neg_Intensity_dB_u=-1*pat_uv_x_dB;
[pks,locs]=findpeaks(neg_Intensity_dB_u);
max_loc=find(pat_uv_x_dB==max(pat_uv_x_dB));
[val,idx]=min(abs(max_loc(1)-locs));

%SLL-u
pat_uv_x(1,max_loc(1)-val:max_loc(1)+val)=0;
pat_uv_x_dB=10.*log10(pat_uv_x);
SLL_u=max(pat_uv_x_dB);


%SLL-v
neg_Intensity_dB_v=-1*pat_uv_y_dB;
[pks,locs]=findpeaks(neg_Intensity_dB_v);
max_loc=find(pat_uv_y_dB==max(pat_uv_y_dB));
[val,idx]=min(abs(max_loc(1)-locs));

pat_uv_y(1,max_loc(1)-val:max_loc(1)+val)=0;
pat_uv_y_dB=10.*log10(pat_uv_y);
SLL_v=max(pat_uv_y_dB);
